"use strict";angular.module("fpt.angular-tts",[]).factory("openfptTts",["$http","$timeout",function($http,$timeout){var self={},rootUrl="http://api.openfpt.vn/text2speech/v3/",count=0,audioElement=document.getElementById(self.elementId),loadTrack=function(url){audioElement.src=url,audioElement.load()},playTrack=function(url,cb){var canplay=function(){audioElement.removeEventListener("canplay",canplay,!1),audioElement.addEventListener("ended",callback,!1),audioElement.play()},onError=function(){$timeout(function(){loadTrack(url)},1e3)},callback=function(){audioElement.removeEventListener("error",onError,!1),audioElement.removeEventListener("ended",callback,!1),cb()};audioElement.addEventListener("canplay",canplay,!1),audioElement.addEventListener("error",onError,!1),loadTrack(url)},speak=function(text,speechOptions,successCallback,errorCallback){speakArray([text],speechOptions,successCallback,errorCallback)},speakArray=function(texts,speechOptions,callback){var voice=self.voice,speed=self.speed,play=function(text,cb){var tmpOptions={voice:"both",speed:0};speechOptions&&(tmpOptions.voice=speechOptions.voice||tmpOptions.voice,tmpOptions.speed=speechOptions.speed||tmpOptions.speed);var options={method:"POST",url:rootUrl,skipAuthorization:!0,headers:{"content-type":"application/json",voice:"both"===voice?count++%2?"male":"female":voice,speed:speed,api_key:self.apiKey},data:JSON.stringify(text)};$http(options).then(function(res){var data=res.data;playTrack(data.async,cb)},function(){callback(new Error)})};audioElement=document.getElementById(self.elementId);var playId=function(i){if(texts){if(!(i<texts.length))return callback(null,{});play(texts[i],function(err){return err?void 0:playId(i+1)})}};playId(0)};return self={speak:speak,speakArray:speakArray,elementId:"openfpt-tts",apiKey:"",voice:"both",speed:0}}]);