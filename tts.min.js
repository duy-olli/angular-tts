"use strict";angular.module("fpt.angular-tts",[]).factory("openfptTts",["$http","$timeout",function($http,$timeout){var self={},count=0,audioElement=document.getElementById(self.elementId),loadTrack=function(url){audioElement.src=url,audioElement.load()},playCurrentTrack=function(cb){var callback=function(){cb(),audioElement.removeEventListener("ended",callback,!1)};audioElement.play(),audioElement.addEventListener("ended",callback,!1)},speak=function(text,speechOptions,successCallback,errorCallback){speakArray([text],speechOptions,successCallback,errorCallback)},speakArray=function(texts,speechOptions,callback){var voice=self.voice,play=function(text,cb){var options={method:"POST",url:"http://api.openfpt.vn/text2speech/?api_key="+self.apiKey,headers:{"content-type":"application/json",voice:"both"===voice?count++%2?"male":"female":voice},data:JSON.stringify(text)};$http(options).then(function(res){var data=res.data;$timeout(function(){loadTrack(data.async),playCurrentTrack(cb)},5e3)},function(){callback(new Error)})};audioElement=document.getElementById(self.elementId);var playId=function(i){if(texts){if(!(i<texts.length))return callback(null,{});play(texts[i],function(){playId(i+1)})}};playId(0)};return self={speech:speak,speechArray:speakArray,elementId:"openfpt-tts",apiKey:"",voice:"both"}}]);